# 后厨备货系统

一个简洁高效的后厨库存管理系统，帮助餐厅管理物料库存、记录采购、进行日终盘点，并自动生成采购建议。

## 功能特点

### 1. 物料管理
- 添加、编辑和删除物料
- 设置物料名称、单位、Par Level（预设库存下限）和安全库存
- Par Level 用于计算采购建议：Par Level = 平均日耗量 × 供应商送货周期 + 安全库存

### 2. 采购登记
- 记录每日采购数量
- 查看采购计划列表
- 支持批量创建采购计划

### 3. 日终盘点
- 录入实际库存数量（期末实盘）
- 自动计算消耗量：消耗量 = 期初库存 + 今日采购 - 期末库存
- 系统自动计算期初库存（昨日期末库存 + 今日采购）

### 4. 采购建议
- 基于 Par Level 生成采购建议
- 基于平均日消耗量生成采购建议
- 支持批量创建采购计划

### 5. 报表分析
- 日报表、周报表、月报表
- 查看物料消耗趋势
- 统计总消耗量和平均日耗
- 支持按物料筛选

## 技术栈

- **前端**: Next.js 14 (App Router), React, TypeScript, Tailwind CSS
- **后端**: Next.js API Routes
- **数据库**: Prisma + SQLite (开发环境) / PostgreSQL (生产环境)
- **部署**: Vercel

## 安装和运行

### 1. 安装依赖

```bash
npm install
```

### 2. 初始化数据库

```bash
npx prisma generate
npx prisma db push
```

### 3. 运行开发服务器

```bash
npm run dev
```

访问 [http://localhost:3000](http://localhost:3000) 查看应用。

### 4. 查看数据库（可选）

```bash
npx prisma studio
```

## 使用流程

### 1. 初始化物料
1. 进入"物料管理"页面
2. 添加所有需要管理的物料
3. 设置每个物料的 Par Level 和安全库存

### 2. 每日采购登记
1. 进入"采购登记"页面
2. 选择采购日期
3. 录入当日采购数量

### 3. 日终盘点
1. 进入"日终盘点"页面
2. 选择盘点日期
3. 点击"初始化今日记录"（如果还没有记录）
4. 在"期末实盘"列输入实际库存数量
5. 系统自动计算消耗量

### 4. 查看采购建议
1. 进入"采购建议"页面
2. 选择采购日期（通常是明天）
3. 查看系统生成的采购建议
4. 可以批量创建采购计划或单独创建

### 5. 查看报表
1. 进入"报表分析"页面
2. 选择报表类型（日/周/月）
3. 选择日期范围
4. 查看物料消耗统计和趋势

## 数据模型

### Item (物料表)
- `id`: 物料ID
- `name`: 物料名称
- `unit`: 单位（如：kg, 个, 箱）
- `parLevel`: 预设库存下限（Par Level）
- `safetyStock`: 安全库存

### InventoryRecord (库存记录表)
- `id`: 记录ID
- `date`: 日期
- `itemId`: 物料ID
- `startQty`: 期初库存
- `receivedQty`: 当天采购量
- `endQty`: 期末实盘
- `usage`: 消耗量（自动计算）

### PurchaseOrder (采购计划表)
- `id`: 采购计划ID
- `date`: 采购日期
- `itemId`: 物料ID
- `plannedQty`: 计划采购数量
- `confirmed`: 是否已确认
- `actualQty`: 实际采购数量（可选）

## 采购建议算法

系统使用两种方法生成采购建议：

1. **基于 Par Level**（优先）：
   - 建议采购量 = Par Level - 当前期末库存
   - 如果当前库存低于 Par Level，建议采购差额部分

2. **基于平均消耗量**（如果没有设置 Par Level）：
   - 计算最近30天的平均日消耗量
   - 建议采购量 = 平均日消耗量 × 1.2（多采购20%作为缓冲）

## 部署到 Vercel

1. 将代码推送到 GitHub
2. 在 Vercel 中导入项目
3. 配置环境变量（如果需要）
4. 部署数据库（建议使用 Vercel Postgres 或外部数据库服务）
5. 运行数据库迁移：`npx prisma db push`

## 注意事项

1. **数据库**: 开发环境使用 SQLite，生产环境建议使用 PostgreSQL
2. **数据备份**: 定期备份数据库，避免数据丢失
3. **Par Level 设置**: 根据实际运营情况定期调整 Par Level，应对季节性变化
4. **权限管理**: 当前版本没有实现权限管理，可根据需要添加用户认证和角色管理

## 未来改进

- [ ] 用户认证和权限管理
- [ ] 供应商管理
- [ ] 价格管理
- [ ] 库存预警（低库存提醒）
- [ ] 移动端支持
- [ ] 数据导出（Excel/CSV）
- [ ] 机器学习预测需求
- [ ] 多餐厅支持

## 许可证

MIT

